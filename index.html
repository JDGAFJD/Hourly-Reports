<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hourly Chat Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
</head>
<body>
  <div class="container my-5">
    <h1 class="text-center mb-4">Hourly Chat Report</h1>
    <form id="reportForm" action="https://script.google.com/macros/s/AKfycbwLLgpaOj5yzrsK_2IGK4qZ38tpePhdc_9TGTxlzlsfA4B95HAEnTuZEFwgBlQqSUse/exec" method="post">
      <!-- Agent and Time Selection -->
      <div class="form-group">
        <label for="agentName">Name of the agent:</label>
        <select class="form-control" id="agentName" name="AgentName" required>
          <option value="">Select Agent</option>
          <option>Agent1</option>
          <option>Agent2</option>
          <option>Agent3</option>
          <option>Agent4</option>
          <option>Agent5</option>
          <option>Agent6</option>
          <option>Agent7</option>
          <option>Agent8</option>
          <option>Agent9</option>
          <option>Agent10</option>
          <option>Agent11</option>
          <option>Agent12</option>
          <option>Agent13</option>
          <option>Agent14</option>
          <option>Agent15</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="reportDate">Date:</label>
          <input type="date" class="form-control" id="reportDate" name="ReportDate" required />
        </div>
        <div class="form-group col-md-6">
          <label for="reportHour">Hour (CST):</label>
          <select class="form-control" id="reportHour" name="ReportHour" required>
            <option value="">Select Hour</option>
            <option>8am</option>
            <option>9am</option>
            <option>10am</option>
            <option>11am</option>
            <option>12pm</option>
            <option>1pm</option>
            <option>2pm</option>
            <option>3pm</option>
            <option>4pm</option>
            <option>5pm</option>
            <option>6pm</option>
            <option>7pm</option>
          </select>
        </div>
      </div>
      
      <div class="alert alert-info">
        <strong>Total Number of Chats:</strong> <span id="overallTotal">0</span>
      </div>

      <!-- Billing Section -->
      <div class="card mb-3">
        <div class="card-header">Billing</div>
        <div class="card-body" id="billingSection">
          <div class="form-group">
            <label>Charged after cancelation:</label><br>
            <div data-radio-group="ChargedAfterCancelation"></div>
          </div>
          <div class="form-group">
            <label>With 14 days MBG:</label><br>
            <div data-radio-group="With14DaysMBG"></div>
          </div>
          <div class="form-group">
            <label>Add-ons/extra charges:</label><br>
            <div data-radio-group="AddOnsExtraCharges"></div>
          </div>
          <div class="form-group">
            <label>Wanting to pay their bill:</label><br>
            <div data-radio-group="WantingToPay"></div>
          </div>
          <div class="form-group">
            <label>Extensions:</label><br>
            <div data-radio-group="Extensions"></div>
          </div>
        </div>
        <div class="card-footer text-right">
          <strong>Total Billing Chats:</strong> <span id="billingTotal">0</span>
        </div>
      </div>

      <!-- Tech Section -->
      <div class="card mb-3">
        <div class="card-header">Tech</div>
        <div class="card-body" id="techSection">
          <div class="form-group">
            <label>Activation:</label><br>
            <div data-radio-group="Activation"></div>
          </div>
          <div class="form-group">
            <label>Slow speeds:</label><br>
            <div data-radio-group="SlowSpeeds"></div>
          </div>
          <div class="form-group">
            <label>Internet stopping out of nowhere:</label><br>
            <div data-radio-group="InternetStopping"></div>
          </div>
          <div class="form-group">
            <label>Internet not working after resuming service (pay bill/resume subscription):</label><br>
            <input type="range" class="form-control-range" id="InternetNotWorking" name="InternetNotWorking" min="0" max="15" value="0" />
            <span id="InternetNotWorkingValue">0</span>
          </div>
          <div class="form-group">
            <label>Replacements (replacement activation):</label><br>
            <div data-radio-group="Replacements"></div>
          </div>
        </div>
        <div class="card-footer text-right">
          <strong>Total Tech Chats:</strong> <span id="techTotal">0</span>
        </div>
      </div>

      <!-- Cancelation Section -->
      <div class="card mb-3">
        <div class="card-header">Cancelation</div>
        <div class="card-body" id="cancelationSection">
          <div class="form-group">
            <label>Found another provider:</label><br>
            <div data-radio-group="FoundAnotherProvider"></div>
          </div>
          <div class="form-group">
            <label>Slow speeds:</label><br>
            <div data-radio-group="CancelationSlowSpeeds"></div>
          </div>
          <div class="form-group">
            <label>Not consistent enough:</label><br>
            <div data-radio-group="NotConsistentEnough"></div>
          </div>
          <div class="form-group">
            <label>No longer needed:</label><br>
            <div data-radio-group="NoLongerNeeded"></div>
          </div>
          <div class="form-group">
            <label>Customer service:</label><br>
            <div data-radio-group="CustomerService"></div>
          </div>
          <div class="form-group">
            <label>Too Expensive:</label><br>
            <div data-radio-group="TooExpensive"></div>
          </div>
          <div class="form-group">
            <label>Thought it was a 14 days free trial:</label><br>
            <div data-radio-group="FourteenDaysFreeTrial"></div>
          </div>
          <div class="form-group">
            <label>Pre Order cancelation:</label><br>
            <div data-radio-group="PreOrderCancelation"></div>
          </div>
        </div>
        <div class="card-footer text-right">
          <strong>Total Cancelation Chats:</strong> <span id="cancelationTotal">0</span>
        </div>
      </div>

      <!-- Shipping Delay Section -->
      <div class="card mb-3">
        <div class="card-header">Shipping Delay Chats</div>
        <div class="card-body" id="shippingSection">
          <div class="form-group">
            <label>Add shipping delay chats:</label><br>
            <div data-radio-group="ShippingDelay"></div>
          </div>
        </div>
        <div class="card-footer text-right">
          <strong>Total Shipping Delay Chats:</strong> <span id="shippingTotal">0</span>
        </div>
      </div>

      <button type="submit" class="btn btn-primary btn-block">Submit</button>
    </form>

    <div id="reportDisplay" class="mt-5" style="display:none;"></div>
  </div>

  <!-- Bootstrap & dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Function to create radio button groups dynamically
    function createRadioGroup(name) {
      let radios = '';
      for (let i = 0; i <= 10; i++) {
        radios += `
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="${name}" id="${name}${i}" value="${i}">
            <label class="form-check-label" for="${name}${i}">${i}</label>
          </div>
        `;
      }
      return radios;
    }

    // Initialize radio groups and event listeners on DOM load
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('[data-radio-group]').forEach(el => {
        let fieldName = el.getAttribute('data-radio-group');
        el.innerHTML = createRadioGroup(fieldName);
      });

      document.querySelectorAll('input[type=radio], input[type=range]').forEach(el => {
        el.addEventListener('change', calculateTotals);
      });
      calculateTotals();
    });

    function calculateTotals() {
      // Billing totals
      let billingSum = 0;
      document.querySelectorAll('#billingSection input[type=radio]:checked')
        .forEach(el => billingSum += parseInt(el.value) || 0);
      document.getElementById('billingTotal').textContent = billingSum;

      // Tech totals
      let techSum = 0;
      document.querySelectorAll('#techSection input[type=radio]:checked')
        .forEach(el => techSum += parseInt(el.value) || 0);
      let sliderVal = parseInt(document.getElementById('InternetNotWorking').value) || 0;
      techSum += sliderVal;
      document.getElementById('techTotal').textContent = techSum;
      document.getElementById('InternetNotWorkingValue').textContent = sliderVal;

      // Cancelation totals
      let cancelationSum = 0;
      document.querySelectorAll('#cancelationSection input[type=radio]:checked')
        .forEach(el => cancelationSum += parseInt(el.value) || 0);
      document.getElementById('cancelationTotal').textContent = cancelationSum;

      // Shipping totals
      let shippingSum = 0;
      document.querySelectorAll('#shippingSection input[type=radio]:checked')
        .forEach(el => shippingSum += parseInt(el.value) || 0);
      document.getElementById('shippingTotal').textContent = shippingSum;

      // Overall total
      let overall = billingSum + techSum + cancelationSum + shippingSum;
      document.getElementById('overallTotal').textContent = overall;
    }

    // Form submission handling
    document.getElementById("reportForm").addEventListener("submit", function(event) {
      event.preventDefault();
      var form = this;
      var xhr = new XMLHttpRequest();
      xhr.open("POST", form.action);
      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            var formData = new FormData(form);
            var data = Object.fromEntries(formData.entries());
            var summaryHtml = '<h2>Report Summary</h2><ul class="list-group">';
            for (var key in data) {
              summaryHtml += '<li class="list-group-item"><strong>' + key + ':</strong> ' + data[key] + '</li>';
            }
            summaryHtml += '</ul>';
            summaryHtml += '<p class="mt-3">Please post this report in the CS channel.</p>';
            summaryHtml += '<button id="newResponse" class="btn btn-secondary mt-3">Submit another response</button>';
            document.getElementById('reportDisplay').innerHTML = summaryHtml;
            document.getElementById('reportDisplay').style.display = 'block';
            form.style.display = 'none';
            document.getElementById('newResponse').addEventListener('click', function() {
              form.reset();
              calculateTotals();
              form.style.display = 'block';
              document.getElementById('reportDisplay').style.display = 'none';
            });
          } else {
            alert("Submission failed. Please try again.");
          }
        }
      };
      xhr.send(new FormData(form));
    });
  </script>
</body>
</html>
